<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
</HEAD>

<BODY>
<H1>Programování pro X Window System (13)</H1>

<B>Martin Beran</B>
<EM>&lt;<A href="mailto:beran@ms.mff.cuni.cz">beran@ms.mff.cuni.cz</A>&gt;</EM>

<H2>Jak vytvoøit dobré GUI</H2>

<P>Grafické u¾ivatelské rozhraní by mìlo být snadno ovladatelné, pøehledné a
intuitivní. Pro toolkity a desktopová prostøedí obvykle existují
pravidla, jak mají aplikace vypadat a fungovat. Napø. pro GNOME je to dokument
<A href="http://developer.gnome.org/projects/gup/hig/">GNOME Human Interface
Guidelines</A>. Podobnì styl KDE aplikací definuje dokument <A
href="http://developer.kde.org/documentation/standards/kde/style/basics/index.html">KDE
User Interface Guidelines</A>. Je vhodné se tìchto pravidel dr¾et, proto¾e
u¾ivatelé mají za¾itý urèitý zpùsob ovládání grafického prostøedí, v&nbsp;nìm¾
pracují, a jsou zvyklí na standardní vzhled a rozmístìní jednotlivých
ovládacích prvkù GUI. Samozøejmì existují situace, kdy je vhodné nìkteré
pravidlo poru¹it. Ale programátor by pro to mìl mít dostateènì dobrý dùvod.
Takovým dùvodem není, ¾e se mu alternativní vzhled GUI prostì zdá lep¹í.
Ka¾dému se líbí nìco jiného a standardní pravidla jsou dobrým kompromisem.
Nestandardní chování aplikace nutí u¾ivatele uèit se nová pravidla a
navíc si pamatovat, ¾e platí pouze pro tuto jednu aplikaci.

<P>Jednotlivé programy by nemìly zapadnout do celého grafického u¾ivatelského 
prostøedí jen vzhledovì, ale i funkènì. Napø. je potøeba, aby aplikace ¹la
pøidat do menu a aby se její ikona správnì zobrazovala v&nbsp;panelu. Ka¾dá
aplikace by mìla pou¾ívat stejný zpùsob konfigurace jako ostatní komponenty
desktopu a brát ohled na globální nastavení, napø. stylu widgetù, klávesových
zkratek, nebo jazyka. Integrovaná desktopová prostøedí obvykle obsahují
mechanismus pro komunikaci a propojování aplikací a pro vkládání dokumentù
z&nbsp;jedné aplikace do jiné. V&nbsp;GNOME se pou¾ívá CORBA, KDE má vlastní
nástroje DCOP a KParts. Ka¾dá aplikace, u&nbsp;ní¾ to má jen trochu smysl, by
tyto komunikaèní mechanismy mìla pou¾ívat. U¾ pøi psaní programu je dobré
myslet na pozdìj¹í lokalizaci do jiných jazykù. Ideální je, kdy¾ lze
lokalizaci provést pouhým pøelo¾ením souboru textù pou¾ívaných
v&nbsp;programu, bez zásahu do kódu.

<P>Na zaèátku KDE User Interface Guidelines je definováno nìkolik obecných
pravidel, kterých je dobré se pøi návrhu aplikace dr¾et. Tato pravidla do
znaèné míry platí pro ve¹kerý software, i kdy¾ nepou¾ívá GUI. Program by mìl:
<UL>
<LI><EM>být vhodný pro daný úèel</EM>: Nemìl by nabízet nadbyteèné funkce, je¾
matou u¾ivatele.
<LI><EM>být pochopitelný</EM>: Kdy¾ u¾ivatel program pou¾ije poprvé, mìl by být
schopen rychle zjistit, jak funguje, a nauèit se ho pou¾ívat.
<LI><EM>umo¾òovat snadnou navigaci</EM>: U¾ivatel by mìl stále vìdìt, kde se
nachází. Navigace u¾ivatele mezi èástmi aplikace by nemìla být pøíli¹
omezována.
<LI><EM>odpovídat oèekáváním</EM>: Program by mìl fungovat konzistentnì.
<LI><EM>být tolerantní k&nbsp;chybám</EM>: U¾ivatelé dìlají chyby. Program by mìl
na chyby rozumnì zareagovat a poskytovat funkci Undo.
<LI><EM>poskytovat zpìtnou vazbu</EM>: Aplikace by mìla u¾ivateli okam¾itì
oznamovat, jaké funkce provádí.
</UL>

<P>Typická GUI aplikace má hlavní okno s&nbsp;menu a toolbarem v&nbsp;horní
èásti a stavovým øádkem na dolním okraji. Správné menu obsahuje ve¹keré mo¾né
akce. Pokud nìjakou akci nelze v&nbsp;urèitém okam¾iku provést, pøíslu¹ná
polo¾ka menu by mìla být zakázaná, ale stále viditelná. V&nbsp;menu je dobré
dodr¾ovat obvyklé uspoøádání polo¾ek a rozdìlení do submenu. Dobrým zvykem je
u&nbsp;v¹ech polo¾ek, které po aktivaci nejprve otevøou dialog, psát na konci
jména tøi teèky. V&nbsp;menu tedy je &bdquo;New&ldquo; a &bdquo;Save&ldquo;,
ale &bdquo;Open...&ldquo; a &bdquo;Save As...&ldquo;. Do stavového øádku se
zapisují ménì dùle¾ité informace pro u¾ivatele o&nbsp;aktuálním stavu programu
a o&nbsp;provádìných akcích. Zásadní zprávy, o&nbsp;kterých si chce být
programátor jist, ¾e je u¾ivatel nepøehlédne, je tøeba zobrazit ve formì
modálního dialogu. Hlavní okno aplikace by mìlo být rozumnì pou¾itelné i
v&nbsp;malém rozli¹ení obrazovky (800x600 nebo dokonce 640x480) a zároveò by
mìlo být schopno vyu¾ít libovolnì velký prostor pøi maximálním zvìt¹ení na
obrazovce s&nbsp;velkým rozli¹ením.

<P>Program v&nbsp;X by mìl po celou dobu bìhu reagovat na podnìty u¾ivatele a podle
potøeby pøekreslovat svá okna. Øízení se musí dostateènì èasto vracet do cyklu
pro zpracování událostí. Handlery událostí proto nesmí bì¾et moc dlouho.
Jestli¾e je nutné provést èasovì nároènìj¹í akci, jako ètení souboru nebo
slo¾itìj¹í matematický výpoèet, je potøeba ji rozdìlit na men¹í úseky, volat
je pomocí èasovaèe nebo jako idle funkci a mezitím se vracet do zpracování
událostí. Dal¹í varianta je pøesunout dlouhotrvající výpoèet do samostatného
vlákna èi procesu. Kdy¾ je program nìèím zamìstnán a nemù¾e provádìt po¾adavky
u¾ivatele, mìl by to dát vizuálnì najevo. Pokud tento stav trvá maximálnì pár
sekund, staèí zmìnit tvar kurzoru, obvykle na symbol hodin. Pro del¹í èasy se
pou¾ívá progress bar. Ten je obvykle k&nbsp;dispozici ve dvou módech. V&nbsp;jednom
ukazuje, jaká èást práce je hotova a kolik zbývá, v&nbsp;druhém pouze indikuje, ¾e
program stále pracuje. První mód je lep¹í, ale jen za pøedpokladu, ¾e
zobrazená hodnota dává dobrý odhad, jak dlouho bude muset u¾ivatel je¹tì
èekat.

<P>Dialogová okna je lep¹í vytváøet jako nemodální, proto¾e takové dialogy
neomezují interakci u¾ivatele s&nbsp;programem. Modální dialogy jsou vhodné pouze
v&nbsp;situaci, kdy¾ program potøebuje, aby u¾ivatel zadal nìjaké hodnoty døíve, ne¾
mù¾e pokraèovat dál. Toolkity poskytují øadu standardních dialogù pro
zobrazování zpráv, výbìr souborù nebo fontù, nastavení barev, apod. Tyto
standardní dialogy je vhodné pou¾ívat, proto¾e to pøispívá ke konzistenci
aplikace se zbytkem u¾ivatelského prostøedí. Správný dialog by mìl jít
zobrazit i v&nbsp;rozli¹ení 640x480, ale zároveò by mìlo být mo¾né ho zvìt¹it na
celou obrazovku. Pøi zvìt¹ování je tøeba pøidìlit nejvíc místa widgetùm
obsahujícím nejvìt¹í mno¾ství dat, napø. dlouhý seznam.

<H2>Otevøené systémy</H2>

<P>X Window System je dobrým pøíkladem otevøeného systému. Zde je tøeba
zdùraznit, ¾e otevøený program není toté¾, co open source program. Leckterý
proprietární komerèní software je více otevøený, ne¾ nìkteré open source
programy. Zde termín &bdquo;otevøený&ldquo; neznamená software, který je mo¾né
pou¾ívat zadarmo nebo jeho¾ zdrojový kód je zveøejnìný. Jde o&nbsp;to, ¾e otevøený
program èi systém pou¾ívá zveøejnìné a dobøe dokumentované formáty dat a
rozhraní. Tím je usnadnìna spolupráce s&nbsp;dal¹ími programy a mo¾nost pou¾ití
rùzných implementací té¾e funkcionality od rùzných výrobcù nebo na rùzných
platformách.

<P>Otevøené systémy bývají modulární, s&nbsp;jasnì oddìlenými moduly komunikujícími
pøes dobøe definovaná rozhraní. To umo¾òuje podle potøeby pou¾ívat rùzné
varianty tìch¾e modulù. V&nbsp;X jsou jasnì oddìlené ni¾¹í vrstvy (X protokol a
Xlib) od vy¹¹ích vrstev (toolkity a window manager). U¾ivatel si mù¾e vybrat
z&nbsp;velkého mno¾ství window managerù podle svého vkusu a programátor má na výbìr
z&nbsp;øady toolkitù. Programy pou¾ívající rùzné toolkity mohou nejen bì¾et souèasnì,
ale umí si i navzájem pøedávat data. X klient a X server mohou spolupracovat,
i kdy¾ jsou spu¹tìny na odli¹ných architekturách, napø. klient na nìjakém
superpoèítaèi a server na unixové pracovní stanici, PC s&nbsp;Linuxem nebo dokonce
s&nbsp;Windows.

<P>Dùle¾itou vlastností otevøeného softwaru je kvalitní dokumentace. Zde open
source èasto zaostává. Pro ilustraci tohoto faktu se staèí podívat do
manuálových stránek Linuxu na jedné a komerèních Unixù na druhé stranì.
Nedostateèná dokumentace je èastá právì u&nbsp;programù s&nbsp;GUI. Dùvod je jasný
&ndash; program s&nbsp;øádkovým rozhraním obvykle nejde rozumnì pou¾ívat, pokud
není k&nbsp;dispozici popis pøepínaèù nebo pøíkazù, jimi¾ lze ovládat. U&nbsp;grafických
programù mají jejich autoøi tendenci spoléhat na intuitivnost u¾ivatelského
rozhraní a pak opomenou zdokumentovat i vìci, je¾ intuitivní nejsou. Èasto
chybí i popis konfiguraèních souborù a tak ten, kdo nechce pou¾ívat klikací
rozhraní pro konfiguraci programu, má smùlu.

<P>Nedostateèná bývá nejen u¾ivatelská, ale v&nbsp;je¹tì vìt¹í míøe i
programátorská dokumentace. Øada programátorù se bohu¾el mylnì domnívá, ¾e
rozumnì strukturovaný a komentovaný zdrojový text je dostateènou
programátorskou dokumentací. Zvlá¹tì ¹patné je, kdy¾ neexistuje kompletní
specifikace rozhraní nìjakého modulu nebo knihovny a programátor musí jeho
fungování lu¹tit ze zdrojového kódu, místo aby se soustøedil na vývoj svého
programu. Navíc pak není v¾dy jasné, co je správné chování nìjaké funkce a co
chyba nebo implementaèní detail, který se mù¾e v&nbsp;dal¹í verzi zmìnit. Právì
rozdíly v&nbsp;úrovni dokumentace jsou jedním z&nbsp;hlavních dùvodù, proè se mi líbí Qt
víc ne¾ GTK+.

<H2>Grafické a textové rozhraní</H2>

<P>Pod pojmem textové nebo øádkové rozhraní zde rozumím ovládání programu
pomocí parametrù na pøíkazové øádce a textových pøíkazù. Program, be¾ící sice
v&nbsp;textovém re¾imu, ale pou¾ívající ovládání pomocí menu a my¹i se od plnì
grafických programù li¹í pouze ménì atraktivním vzhledem, nikoliv stylem
fungování.

<P>Mezi u¾ivateli poèítaèù je roz¹íøené pøesvìdèení, ¾e pøíkazový øádek je
èímsi zastaralým a kvalitní moderní program musí mít grafické rozhraní.
Zastánci tohoto názoru øíkají, ¾e GUI má výhodu v&nbsp;tom, ¾e je snadné na nauèení
a u¾ivatelsky pøívìtivé. První tvrzení je obvykle pravdivé, druhé v¹ak ne
v¾dy. Grafické rozhraní umo¾òuje snadno provádìt jednotlivé operace, pro nì¾
existují polo¾ky menu. Problém nastane, kdy¾ je potøeba provést komplexnìj¹í
nebo opakovanou operaci. Z&nbsp;u¾ivatele se pak stává cvièená opice, která
opakovanì mechanicky kliká na stejné polo¾ky menu a vyplòuje stejné dialogy.

<P>Pøedstavme si, ¾e v&nbsp;grafickém editoru chceme zmìnit velikost obrázku.
Vybereme v&nbsp;menu polo¾ku &bdquo;Open&ldquo; a v&nbsp;dialogovém oknì vybereme soubor
s&nbsp;obrázkem. Po otevøení souboru najdeme v&nbsp;menu funkci &bdquo;Resize&ldquo;,
která si je¹tì otevøe dialog pro zadání nové velikosti obrázku. Celou akci
zavr¹íme kliknutím na &bdquo;Save&ldquo;. Potud je v¹echno v&nbsp;poøádku. Ov¹em co
kdy¾ takto chceme upravit ne jeden, ale sto obrázkù? V&nbsp;tu chvíli je lep¹í
vrátit se k&nbsp;øádkovým utilitám a shellu. Zmìnu velikosti v¹ech obrázkù
provedeme jediným pøíkazem
<PRE>
for f in *.jpg; do convert $f -resize 800x600 resized$f; done
</PRE>

<P>Lze samozøejmì namítnout, ¾e taková hromadná operace je èasto pou¾ívaná
a proto ji leckterý grafický editor umí udìlat tak, ¾e si u¾ivatel vybere
seznam souborù a nechá provést po¾adovanou operaci na v¹echny. Jenom¾e mno¾ina
funkcí programu je v¾dy omezená. Na druhou stranu øádkové programy mohou být
pomocí shellu neomezenì kombinovány. Textové ovládání mù¾e být pro zku¹eného
u¾ivatele pøíjemnìj¹í i pro provádìní jednotlivých akcí. Napsat pøíkaz
s&nbsp;parametry je toti¾ èasto rychlej¹í ne¾ vybrat polo¾ku z&nbsp;rozvìtvené struktury
menu a vyplnit parametry v&nbsp;dialogovém oknì. To asi potvrdí ka¾dý znalec TeXu,
který se kdy pokou¹el vyrobit vzorec pomocí my¹i v&nbsp;editoru rovnic z&nbsp;MS nebo
Open Office. I&nbsp;textové programy, které interaktivnì komunikují s&nbsp;u¾ivatelem,
lze spou¹tìt dávkovì s&nbsp;pou¾itím nástrojù jako je <TT>expect</TT>. 

<P>Dal¹í oblastí, kde grafické rozhraní èasto selhává, je manipulace
s&nbsp;konfigurací programù. U¾ivatel je odkázán na sadu dialogù, kde mù¾e nastavovat
jednotlivé konfiguraèní hodnoty, co¾ vypadá na první pohled dobøe, av¹ak najít
urèitou polo¾ku nebo nastavit mno¾inu polo¾ek na stejnou hodnotu v&nbsp;rozsáhlé
konfiguraci nemusí být snadné. S&nbsp;textovým konfiguraèním souborem takový
problém odpadá, proto¾e staèí v&nbsp;textovém editoru pou¾ít funkci pro hledání a
nahrazování textu. Velmi u¾iteèné je zaznamenávat posloupnost zmìn
v&nbsp;konfiguraci, archivovat její jednotlivé verze a umìt zobrazit rozdíly mezi
nimi. S&nbsp;graficky ovládanou konfigurací ukládanou do kdovíjakých binárních
souborù to je obtí¾né. Pøi pou¾ití textových konfiguraèních souborù staèí
nainstalovat si RCS a po ka¾dé úpravì nìkterého souboru napsat
<PRE>
ci -l soubor
</PRE>

<P>Celkovì se o&nbsp;mnohých programech s&nbsp;grafickým u¾ivatelským rozhraním dá øíct,
¾e i kdy¾ se sna¾í pùsobit profesionálnì, jsou to ve skuteènosti amatérské
nástroje. Amatér, který vìci pøíli¹ nerozumí a nehodlá se moc uèit, potøebuje
nástroj, který je jednoduchý. Pøitom mu nevadí, ¾e tento nástroj je dost
omezený. Profesionál, jen¾ se svým nástrojem pracuje dennì, se ho bude radìji
déle uèit pou¾ívat, kdy¾ to bude vyvá¾eno vy¹¹í efektivitou práce s&nbsp;ním.

<P>Samozøejmì existují programy, u&nbsp;nich¾ má èistì grafické rozhraní dobrý
smysl. Naopak u&nbsp;nìkterých programù nemá GUI smysl vùbec ¾ádný. U&nbsp;velkého
mno¾ství aplikací je v¹ak nejlep¹í spojit oba zpùsoby ovládání &ndash;
grafický i textový. U¾ivatel tak mù¾e s&nbsp;programem zaèít snadno pracovat pomocí
funkcí dostupných v&nbsp;menu a postupnì se podle potøeby uèit øádkové rozhraní
poskytující pøístup k&nbsp;pokroèilej¹ím schopnostem programu.

<P>Dobrým pøíkladem kombinace textového a grafického rozhraní je debugger
<TT>ddd</TT>. Ve skuteènosti je to X-ová nadstavba nad øádkovým debuggerem
<TT>gdb</TT>. Umo¾òuje v&nbsp;jednom oknì zobrazovat zdrojový text a
nastavovat breakpointy, v&nbsp;dal¹ím oknì zobrazovat hodnoty promìnných,
operace jako spu¹tìní, pøeru¹ení a krokování programu jsou dostupné pomocí
tlaèítek. Ale má také textové okno, v&nbsp;nìm¾ lze psát pøíkazy pro
<TT>gdb</TT>. Dal¹ím pøíkladem úspì¹né kombinace obou pøístupù
k&nbsp;u¾ivatelskému rozhraní je textový editor <TT>gvim</TT>.

<P>Ka¾dý program v&nbsp;X by mìl dovolit nastavení aspoò základních parametrù
na pøíkazovém øádku. Jedná se napø. o&nbsp;identifikaci displeje (X serveru),
k&nbsp;nìmu¾ se má program pøipojit, nebo o&nbsp;seznam souborù, se kterými
bude pracovat. U¾iteèné je, kdy¾ se dá program spustit v&nbsp;dávkovém re¾imu
tak, ¾e provede akce specifikované na pøíkazovém øádku a skonèí. Nejlep¹í je
pøidat ke grafickému programu mo¾nost skriptování, tj. propojit ho
s&nbsp;interpretem nìjakého programovacího jazyka a vyexportovat do interpretu
pro pou¾ití ve skriptech pokud mo¾no ve¹keré operace, je¾ program umí dìlat.

<H2>Závìr</H2>

<P>Tento seriál èlánkù si v&nbsp;¾ádném pøípadì nekladl za cíl být
vyèerpávajícím návodem na psaní programù pro X Window System. ©lo mi
o&nbsp;to, ukázat základní informace o&nbsp;X z&nbsp;pohledu programátora.
Úvod do GTK+, Qt a Xlib by mìl usnadnit ètenáøi orientaci v&nbsp;dané
problematice a poskytnout východisko k&nbsp;dal¹ímu samostatnému studiu a
experimentování. Na mé webové stránce <A
href="http://www.ms.mff.cuni.cz/~beran/vyuka/X/">http://www.ms.mff.cuni.cz/~beran/vyuka/X/</A>
jsou k&nbsp;dispozici poznámky k&nbsp;pøedná¹kám, z&nbsp;nich¾ jsem vycházel
pøi psaní èlánkù. Nemají sice formu souvislého textu, av¹ak místy jdou více do
podrobností. Na stejné stránce lze najít i sadu ukázkových programù
demonstrujících mo¾nosti obou probíraných toolkitù i Xlib a odkazy na nìkteré
internetové zdroje o&nbsp;X.

</BODY>
</HTML>
